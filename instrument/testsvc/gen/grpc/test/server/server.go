// Code generated by goa v3.5.3, DO NOT EDIT.
//
// test gRPC server
//
// Command:
// $ goa gen github.com/crossnokaye/micro/instrument/testsvc/design

package server

import (
	"context"

	testpb "github.com/crossnokaye/micro/instrument/testsvc/gen/grpc/test/pb"
	test "github.com/crossnokaye/micro/instrument/testsvc/gen/test"
	goagrpc "goa.design/goa/v3/grpc"
	goa "goa.design/goa/v3/pkg"
)

// Server implements the testpb.TestServer interface.
type Server struct {
	GrpcMethodH    goagrpc.UnaryHandler
	GrpcStreamingH goagrpc.StreamHandler
	testpb.UnimplementedTestServer
}

// ErrorNamer is an interface implemented by generated error structs that
// exposes the name of the error as defined in the expr.
type ErrorNamer interface {
	ErrorName() string
}

// GrpcStreamingServerStream implements the test.GrpcStreamingServerStream
// interface.
type GrpcStreamingServerStream struct {
	stream testpb.Test_GrpcStreamingServer
}

// New instantiates the server struct with the test service endpoints.
func New(e *test.Endpoints, uh goagrpc.UnaryHandler, sh goagrpc.StreamHandler) *Server {
	return &Server{
		GrpcMethodH:    NewGrpcMethodHandler(e.GrpcMethod, uh),
		GrpcStreamingH: NewGrpcStreamingHandler(e.GrpcStreaming, sh),
	}
}

// NewGrpcMethodHandler creates a gRPC handler which serves the "test" service
// "grpc_method" endpoint.
func NewGrpcMethodHandler(endpoint goa.Endpoint, h goagrpc.UnaryHandler) goagrpc.UnaryHandler {
	if h == nil {
		h = goagrpc.NewUnaryHandler(endpoint, DecodeGrpcMethodRequest, EncodeGrpcMethodResponse)
	}
	return h
}

// GrpcMethod implements the "GrpcMethod" method in testpb.TestServer interface.
func (s *Server) GrpcMethod(ctx context.Context, message *testpb.GrpcMethodRequest) (*testpb.GrpcMethodResponse, error) {
	ctx = context.WithValue(ctx, goa.MethodKey, "grpc_method")
	ctx = context.WithValue(ctx, goa.ServiceKey, "test")
	resp, err := s.GrpcMethodH.Handle(ctx, message)
	if err != nil {
		return nil, goagrpc.EncodeError(err)
	}
	return resp.(*testpb.GrpcMethodResponse), nil
}

// NewGrpcStreamingHandler creates a gRPC handler which serves the "test"
// service "grpc_streaming" endpoint.
func NewGrpcStreamingHandler(endpoint goa.Endpoint, h goagrpc.StreamHandler) goagrpc.StreamHandler {
	if h == nil {
		h = goagrpc.NewStreamHandler(endpoint, nil)
	}
	return h
}

// GrpcStreaming implements the "GrpcStreaming" method in testpb.TestServer
// interface.
func (s *Server) GrpcStreaming(stream testpb.Test_GrpcStreamingServer) error {
	ctx := stream.Context()
	ctx = context.WithValue(ctx, goa.MethodKey, "grpc_streaming")
	ctx = context.WithValue(ctx, goa.ServiceKey, "test")
	_, err := s.GrpcStreamingH.Decode(ctx, nil)
	if err != nil {
		return goagrpc.EncodeError(err)
	}
	ep := &test.GrpcStreamingEndpointInput{
		Stream: &GrpcStreamingServerStream{stream: stream},
	}
	err = s.GrpcStreamingH.Handle(ctx, ep)
	if err != nil {
		return goagrpc.EncodeError(err)
	}
	return nil
}

// Send streams instances of "testpb.GrpcStreamingResponse" to the
// "grpc_streaming" endpoint gRPC stream.
func (s *GrpcStreamingServerStream) Send(res *test.Fields) error {
	v := NewGrpcStreamingResponse(res)
	return s.stream.Send(v)
}

// Recv reads instances of "testpb.GrpcStreamingStreamingRequest" from the
// "grpc_streaming" endpoint gRPC stream.
func (s *GrpcStreamingServerStream) Recv() (*test.Fields, error) {
	var res *test.Fields
	v, err := s.stream.Recv()
	if err != nil {
		return res, err
	}
	return NewFields(v), nil
}

func (s *GrpcStreamingServerStream) Close() error {
	// nothing to do here
	return nil
}
